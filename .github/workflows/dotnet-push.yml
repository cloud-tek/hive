name: "dotnet-push"
on:
  workflow_call:
    # outputs:
    #   artifact-name:
    #     description: "The name of the uploaded artifact"
    #     value: ${{ jobs.dagger.outputs.artifact-name }}
    secrets:
      NUGET_API_KEY:
        description: "NuGet API Key"
        required: false
    inputs:
      artifact-name:
        description: "The name of the artifact containing the packed packages"
        type: string
        required: true
      artifact-path:
        description: "The path to the packages inside the artifact"
        type: string
        required: true
      nuget-api-url:
        description: "NuGet API URL"
        type: string
        default: "https://api.nuget.org/v3/index.json"
        required: false
      net-version:
        description: ".NET version"
        type: string
        default: "10.0"
        required: false
      net-sdk-version:
        description: ".NET SDK version"
        type: string
        default: "10.0.100"
        required: false

jobs:
  dotnet-push:
    name: dotnet-push
    runs-on: ubuntu-latest
    steps:
      - name: download-artifact
        uses: actions/download-artifact@v5
        with:
          name: ${{ inputs.artifact-name }}
          path: ${{ github.workspace }}/artifacts
      - name: tree artifacts
        run: |
          tree ${{ github.workspace }}/artifacts
      - uses: actions/setup-dotnet@v5
        with:
          dotnet-version: ${{ inputs.net-sdk-version }}
      - name: dotnet nuget push
        shell: bash
        working-directory: ${{ github.workspace }}
        run: |
          for package in ${{ github.workspace }}/artifacts/${{ inputs.artifact-path }}; do
            if [ -f "$package" ]; then
              echo "pushing $package ===> ${{ inputs.nuget-api-url }}"
              dotnet nuget push "$package" \
                --source "${{ inputs.nuget-api-url }}" \
                --api-key "${{ secrets.NUGET_API_KEY }}" \
                --skip-duplicate
            fi
          done